package com.app.dao;

public class UserDao implements AutoCloseable {

	private Connection connection = null;

	public UserDao() throws SQLException {
		connection = DbUtil.getConnection();
	}

	public List<Student> getAllStudents() throws SQLException {
		List<Student> studentList = new ArrayList<>();
		String sql = "SELECT rollno,name,email,course FROM students";
		try (PreparedStatement selectStatement = connection.prepareStatement(sql)) {
			ResultSet rs = selectStatement.executeQuery();
			while (rs.next()) {
				Student student = new Student();
				student.setRollno(rs.getInt(1));
				student.setName(rs.getString(2));
				student.setEmail(rs.getString(3));
				student.setCourse(rs.getString(4));
				studentList.add(student);
			}
		}
		return studentList;
	}

	public void insertStudent(Student student) throws SQLException {
		String sql = "INSERT INTO students(name,email,course) VALUES(?,?,?)";
		try (PreparedStatement insertStatement = connection.prepareStatement(sql)) {
			insertStatement.setString(1, student.getName());
			insertStatement.setString(2, student.getEmail());
			insertStatement.setString(3, student.getCourse());
			insertStatement.executeUpdate();
		}
	}

	public void updateStudent(int rollno, String course) throws SQLException {
		String sql = "UPDATE students SET course = ? WHERE rollno = ?";
		try (PreparedStatement updateStatement = connection.prepareStatement(sql)) {
			updateStatement.setString(1, course);
			updateStatement.setInt(2, rollno);
			updateStatement.executeUpdate();
		}
	}

	public void deleteStudent(int rollno) throws SQLException {
		String sql = "DELETE FROM students WHERE rollno = ?";
		try (PreparedStatement deleteStatement = connection.prepareStatement(sql)) {
			deleteStatement.setInt(1, rollno);
			deleteStatement.executeUpdate();
		}
	}

	@Override
	public void close() throws SQLException {
		if (connection != null) {
			connection.close();
			connection = null;
		}
	}

}




